<!doctype html>
<html lang="zh-CN" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tetris Vanilla</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <h1>俄罗斯方块 · Tetris Vanilla</h1>
    <div class="topbar-actions">
      <button id="themeToggleBtn">浅色模式</button>
      <button id="startBtn">开始/重开 (R)</button>
      <button id="pauseBtn">暂停 (P)</button>
      <button id="settingsBtn">设置 (Esc)</button>
    </div>
  </header>

  <main class="layout">
    <section class="board-panel">
      <canvas id="board" width="300" height="600" aria-label="游戏棋盘"></canvas>
      <div id="modeBanner"></div>
      <div id="overlay" class="hidden"></div>
    </section>

    <aside class="side-panel">
      <div class="card">
        <h3>Hold (C)</h3>
        <canvas id="holdCanvas" width="120" height="120"></canvas>
      </div>
      <div class="card">
        <h3>Next x5</h3>
        <canvas id="nextCanvas" width="120" height="320"></canvas>
      </div>
      <div class="card stats">
        <h3>状态</h3>
        <p>模式：<span id="modeName">Classic</span></p>
        <p>当前分数：<span id="score">0</span></p>
        <p>最高分：<span id="highScore">0</span></p>
        <p>等级：<span id="level">1</span></p>
        <p>消行：<span id="lines">0</span></p>
        <p>连击：<span id="combo">0</span></p>
        <p>B2B：<span id="b2b">0</span></p>
        <p>用时：<span id="timer">00:00</span></p>
      </div>
      <div class="card">
        <h3>模式</h3>
        <select id="modeSelect">
          <option value="classic">Classic</option>
          <option value="sprint">Sprint 40 Lines</option>
          <option value="survival">Survival</option>
          <option value="challenge">Challenge</option>
          <option value="zen">Zen</option>
        </select>
      </div>
      <div class="card">
        <h3>新手帮助</h3>
        <ul class="help-list">
          <li>← →：移动</li>
          <li>↓：软降</li>
          <li>Space：硬降</li>
          <li>Z/X/↑：旋转</li>
          <li>C：Hold</li>
          <li>P：暂停/继续</li>
          <li>R：重开</li>
          <li>Esc：设置</li>
        </ul>
      </div>
      <div class="card debug hidden" id="debugPanel"></div>
      <div class="card debug-controls hidden" id="debugControls">
        <h3>调试控制</h3>
        <button id="stepBtn" type="button">单步执行 (Step)</button>
        <button id="runSelfTestsBtn" type="button">运行清行自检</button>
      </div>
    </aside>
  </main>

  <section class="mobile-controls">
    <button data-act="up">▲</button>
    <button data-act="left">◀</button>
    <button data-act="right">▶</button>
    <button data-act="soft">▼</button>
    <button data-act="cw">⟳</button>
    <button data-act="ccw">⟲</button>
    <button data-act="hard">⤓</button>
    <button data-act="hold">H</button>
    <button data-act="pause">II</button>
  </section>

  <dialog id="settingsModal">
    <form method="dialog" class="modal-content" id="settingsForm">
      <h2>设置面板</h2>

      <details open>
        <summary>A) 棋盘与视觉</summary>
        <label>宽度 8-16 <input type="number" name="boardWidth" min="8" max="16"></label>
        <label>高度 16-30 <input type="number" name="boardHeight" min="16" max="30"></label>
        <label><input type="checkbox" name="showGrid">显示网格线</label>
        <label><input type="checkbox" name="showOutline">方块描边</label>
        <label>阴影强度 0-100 <input type="range" name="shadow" min="0" max="100"></label>
        <label>主题
          <select name="theme"><option>dark</option><option>light</option><option>neon</option></select>
        </label>
        <label><input type="checkbox" name="colorBlind">色盲友好符号</label>
      </details>

      <details>
        <summary>B) 速度与手感</summary>
        <label>初始下落速度(ms) <input type="number" name="gravityMs" min="50" max="2000"></label>
        <label>升级规则
          <select name="levelRule"><option value="lines">按消行</option><option value="time">按时间</option><option value="score">按分数</option></select>
        </label>
        <label>DAS(ms) <input type="number" name="das" min="20" max="500"></label>
        <label>ARR(ms) <input type="number" name="arr" min="0" max="200"></label>
        <label>软降倍率 <input type="number" step="0.1" name="softDropMultiplier" min="1" max="40"></label>
        <label>锁定延迟(ms) <input type="number" name="lockDelay" min="50" max="1500"></label>
        <label>踢墙系统
          <select name="kickMode"><option value="off">无</option><option value="simple">简化</option><option value="srs">标准</option></select>
        </label>
        <label>输入缓冲(ms,0关闭) <input type="number" name="inputBufferMs" min="0" max="300"></label>
        <label>旋转重置次数上限 <input type="number" name="maxLockResets" min="0" max="20"></label>
      </details>

      <details>
        <summary>C/D/E/F/G) 模式、计分与辅助</summary>
        <label>计分系统
          <select name="scoringSystem"><option value="modern">Modern</option><option value="classic">Classic</option></select>
        </label>
        <label><input type="checkbox" name="enableGhost">启用 Ghost</label>
        <label><input type="checkbox" name="enableHold">启用 Hold</label>
        <label><input type="checkbox" name="showBestMove">显示最佳落点建议</label>
        <label><input type="checkbox" name="safeHardDrop">硬降二次确认</label>
        <label><input type="checkbox" name="restartKeepSettings">重开不清空设置</label>
        <label>难度预设
          <select name="difficulty"><option value="easy">轻松</option><option value="normal">标准</option><option value="hardcore">硬核</option></select>
        </label>
        <label>音量 <input type="range" name="volume" min="0" max="1" step="0.05"></label>
        <label><input type="checkbox" name="mute">静音</label>
        <label><input type="checkbox" name="vfx">震动/闪烁反馈</label>
        <label><input type="checkbox" name="debug">显示调试面板</label>
      </details>

      <details>
        <summary>调试复现与导入导出</summary>
        <label>固定随机种子 seed <input type="number" name="debugSeed" min="1" max="2147483647"></label>
        <button type="button" id="exportReplayBtn">导出 Replay JSON</button>
        <button type="button" id="importReplayBtn">导入并重放 Replay</button>
        <button type="button" id="exportBtn">导出设置/记录 JSON</button>
        <button type="button" id="importBtn">导入设置/记录 JSON</button>
        <button type="button" id="clearHighScoreBtn">清空当前模式最高分</button>
        <textarea id="ioText" rows="8" placeholder="粘贴导入/导出 JSON"></textarea>
      </details>

      <div class="modal-actions">
        <button type="button" id="presetStandard">标准10x20</button>
        <button type="submit" id="saveSettings">保存并应用</button>
        <button type="button" id="closeSettings">关闭</button>
      </div>
    </form>
  </dialog>

  <script src="main.js"></script>
</body>
</html>
